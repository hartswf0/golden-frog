<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê∏ Golden Frog Narrative Pond</title>
    <style>
        :root {
            --pond-deep-blue: #1B4F72;
            --pond-light-blue: #5DADE2;
            --lily-pad-green: #2ECC71;
            --ripple-color: rgba(255,255,255,0.2);
            --accent-color: #e74c3c;
            --overlay-bg: rgba(0,0,0,0.85);
            --text-color: #ecf0f1;
            --button-bg: #27ae60;
            --button-hover: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, var(--pond-deep-blue), var(--pond-light-blue));
            font-family: 'Arial', sans-serif;
            cursor: grab;
        }

        #pond-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            perspective: 1000px;
            transform-style: preserve-3d;
            overflow: hidden;
        }

        .narrative-node {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--lily-pad-green);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform-origin: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .narrative-node:hover {
            transform: scale(1.2) rotate(360deg);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .narrative-node .emoji {
            font-size: 40px;
            transition: transform 0.3s ease;
        }

        .narrative-node:hover .emoji {
            transform: scale(1.2) rotate(20deg);
        }

        .connection-line {
            position: absolute;
            background: var(--ripple-color);
            pointer-events: none;
            transition: all 0.5s ease;
        }

        #narrative-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 20px;
        }

        #narrative-content {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            color: var(--text-color);
            position: relative;
        }

        #close-narrative {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,0,0,0.5);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        #input-area {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            width: 80%;
            max-width: 600px;
        }

        #user-input {
            flex-grow: 1;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border: 2px solid var(--lily-pad-green);
            border-radius: 20px;
            color: white;
            margin-right: 10px;
            font-size: 16px;
        }

        #submit-story {
            background: var(--button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: transform 0.3s ease, background 0.3s ease;
            font-size: 16px;
        }

        #submit-story:hover {
            transform: scale(1.1);
            background: var(--button-hover);
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: var(--ripple-color);
            transform: scale(0);
            animation: ripple 2s linear infinite;
        }

        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        .user-narrative {
            background: rgba(255,255,255,0.2);
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            color: #fff;
            display: flex;
            align-items: center;
        }

        .user-narrative .icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .data-visualization {
            margin-top: 20px;
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            position: relative;
        }

        .data-visualization canvas {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }

        @media (max-width: 600px) {
            .narrative-node {
                width: 80px;
                height: 80px;
            }

            .narrative-node .emoji {
                font-size: 30px;
            }

            #user-input {
                font-size: 14px;
            }

            #submit-story {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="pond-container"></div>
    <div id="narrative-overlay">
        <div id="narrative-content">
            <button id="close-narrative">‚úñ</button>
            <!-- Dynamic content will be injected here -->
        </div>
    </div>
    <div id="input-area">
        <input type="text" id="user-input" placeholder="Hop into your story...">
        <button id="submit-story">üê∏ Splash!</button>
    </div>

    <script>
        // Fake data for demonstration
        const camerimageData = {
            "CamerimageFestival": {
                "Categories": [
                    {
                        "CategoryName": "Golden Frog Competition",
                        "Nominees": [
                            {
                                "Year": 1993,
                                "NomineeID": "GF1993-001",
                                "NomineeName": "Anna Kowalski",
                                "Gender": "Female",
                                "FilmTitle": "Light Shadows",
                                "Country": "Poland"
                            },
                            {
                                "Year": 1994,
                                "NomineeID": "GF1994-002",
                                "NomineeName": "John Smith",
                                "Gender": "Male",
                                "FilmTitle": "Silent Echoes",
                                "Country": "USA"
                            },
                            // Additional nominees...
                        ]
                    },
                    // Additional categories...
                ],
                "Anomalies": [
                    // Anomaly data...
                ]
            }
        };

        class NarrativePond {
            constructor(data) {
                this.data = data.CamerimageFestival;
                this.container = document.getElementById('pond-container');
                this.narrativeOverlay = document.getElementById('narrative-overlay');
                this.narrativeContent = document.getElementById('narrative-content');
                this.userInput = document.getElementById('user-input');
                this.submitButton = document.getElementById('submit-story');
                this.closeNarrativeBtn = document.getElementById('close-narrative');
                this.categories = this.getInitialCategories();
                this.userNarratives = [];

                this.init();
            }

            init() {
                this.createRippleBackground();
                this.createNarrativeNodes();
                this.setupEventListeners();
            }

            getInitialCategories() {
                return [
                    {
                        id: 'diversity',
                        emoji: 'üåà',
                        title: 'Diversity Insights',
                        description: 'Explore nominee demographics and diversity trends.',
                        color: '#e74c3c'
                    },
                    {
                        id: 'geography',
                        emoji: 'üåç',
                        title: 'Geographic Distribution',
                        description: 'Visualize the global spread of nominees.',
                        color: '#3498db'
                    },
                    {
                        id: 'history',
                        emoji: '‚è≥',
                        title: 'Historical Trends',
                        description: 'Analyze past competition patterns and milestones.',
                        color: '#f1c40f'
                    },
                    {
                        id: 'impact',
                        emoji: 'üí°',
                        title: 'Social Impact',
                        description: 'Measure the competition\'s broader influence on cinematography.',
                        color: '#9b59b6'
                    }
                ];
            }

            createRippleBackground() {
                for (let i = 0; i < 15; i++) {
                    const ripple = document.createElement('div');
                    ripple.classList.add('ripple');
                    ripple.style.left = `${Math.random() * 100}%`;
                    ripple.style.top = `${Math.random() * 100}%`;
                    ripple.style.animationDelay = `${Math.random() * 2}s`;
                    this.container.appendChild(ripple);
                }
            }

            createNarrativeNodes() {
                this.categories.forEach((category, index) => {
                    const node = document.createElement('div');
                    node.classList.add('narrative-node');
                    node.dataset.id = category.id;
                    node.style.backgroundColor = category.color;

                    // Emoji Element
                    const emoji = document.createElement('div');
                    emoji.classList.add('emoji');
                    emoji.textContent = category.emoji;
                    node.appendChild(emoji);

                    // Positioning nodes in a circular layout
                    const angle = (index / this.categories.length) * 2 * Math.PI;
                    const radius = Math.min(window.innerWidth, window.innerHeight) * 0.3;
                    const x = window.innerWidth / 2 + Math.cos(angle) * radius - 50; // 50 is half the node's width
                    const y = window.innerHeight / 2 + Math.sin(angle) * radius - 50; // 50 is half the node's height

                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;

                    // Click event to open narrative
                    node.addEventListener('click', () => this.openNarrative(category));

                    this.container.appendChild(node);
                });

                // Create connections between nodes
                this.createConnections();
            }

            createConnections() {
                const nodes = document.querySelectorAll('.narrative-node');
                nodes.forEach((node, index) => {
                    const nextNode = nodes[(index + 1) % nodes.length];
                    this.drawConnection(node, nextNode);
                });
            }

            drawConnection(node1, node2) {
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute('width', '100%');
                svg.setAttribute('height', '100%');
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.pointerEvents = 'none';

                const path = document.createElementNS(svgNS, 'path');
                const rect1 = node1.getBoundingClientRect();
                const rect2 = node2.getBoundingClientRect();

                const startX = rect1.left + rect1.width / 2 - node1.parentElement.getBoundingClientRect().left;
                const startY = rect1.top + rect1.height / 2 - node1.parentElement.getBoundingClientRect().top;
                const endX = rect2.left + rect2.width / 2 - node2.parentElement.getBoundingClientRect().left;
                const endY = rect2.top + rect2.height / 2 - node2.parentElement.getBoundingClientRect().top;

                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2 - 50; // Control point for the curve

                path.setAttribute('d', `M${startX},${startY} Q${midX},${midY} ${endX},${endY}`);
                path.setAttribute('stroke', 'rgba(255,255,255,0.2)');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');

                svg.appendChild(path);
                this.container.appendChild(svg);
            }

            setupEventListeners() {
                this.submitButton.addEventListener('click', () => this.submitStory());
                this.closeNarrativeBtn.addEventListener('click', () => this.closeNarrativeOverlay());

                // Dragging functionality
                let isDragging = false;
                let startX, startY, scrollLeft, scrollTop;

                this.container.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    this.container.style.cursor = 'grabbing';
                    startX = e.pageX - this.container.offsetLeft;
                    startY = e.pageY - this.container.offsetTop;
                    scrollLeft = this.container.scrollLeft;
                    scrollTop = this.container.scrollTop;
                });

                this.container.addEventListener('mouseleave', () => {
                    isDragging = false;
                    this.container.style.cursor = 'grab';
                });

                this.container.addEventListener('mouseup', () => {
                    isDragging = false;
                    this.container.style.cursor = 'grab';
                });

                this.container.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const x = e.pageX - this.container.offsetLeft;
                    const y = e.pageY - this.container.offsetTop;
                    const walkX = (x - startX) * 1.5; // Scroll-fast
                    const walkY = (y - startY) * 1.5;
                    this.container.scrollLeft = scrollLeft - walkX;
                    this.container.scrollTop = scrollTop - walkY;
                });

                // Gesture-based navigation for touch devices
                let touchStartX = 0;
                let touchEndX = 0;

                this.container.addEventListener('touchstart', (e) => {
                    touchStartX = e.changedTouches[0].screenX;
                }, false);

                this.container.addEventListener('touchend', (e) => {
                    touchEndX = e.changedTouches[0].screenX;
                    this.handleGesture(touchStartX, touchEndX);
                }, false);
            }

            handleGesture(start, end) {
                const diff = end - start;
                if (diff > 50) {
                    // Swipe Right - Rotate Clockwise
                    this.rotatePond(30);
                } else if (diff < -50) {
                    // Swipe Left - Rotate Counter Clockwise
                    this.rotatePond(-30);
                }
            }

            rotatePond(degrees) {
                const currentRotation = this.container.style.transform.replace(/[^0-9\-.,]/g, '').split(',')[0] || 0;
                const newRotation = parseInt(currentRotation) + degrees;
                this.container.style.transition = 'transform 0.5s ease';
                this.container.style.transform = `rotate(${newRotation}deg)`;
            }

            openNarrative(category) {
                this.narrativeContent.innerHTML = `
                    <button id="close-narrative">‚úñ</button>
                    <h2>${category.emoji} ${category.title}</h2>
                    <p>${category.description}</p>
                    <h3>Nominees:</h3>
                    <ul>
                        ${this.getNomineesHTML(category.CategoryName)}
                    </ul>
                    <div class="data-visualization">
                        <canvas id="${category.id}-chart"></canvas>
                    </div>
                `;
                this.narrativeOverlay.style.opacity = '1';
                this.narrativeOverlay.style.pointerEvents = 'all';

                // Re-attach close button listener
                document.getElementById('close-narrative').addEventListener('click', () => {
                    this.closeNarrativeOverlay();
                });

                // Render Data Visualization
                this.renderChart(category);
            }

            getNomineesHTML(categoryName) {
                const category = this.data.Categories.find(cat => cat.CategoryName === categoryName);
                if (!category) return '';
                return category.Nominees.map(nom => `
                    <li><strong>${nom.NomineeName}</strong> (${nom.Year}) - "${nom.FilmTitle}" from ${nom.Country}</li>
                `).join('');
            }

            renderChart(category) {
                const categoryData = this.data.Categories.find(cat => cat.CategoryName === category.CategoryName);
                if (!categoryData) return;

                const ctx = document.getElementById(`${category.id}-chart`).getContext('2d');
                const genderCount = categoryData.Nominees.reduce((acc, nom) => {
                    acc[nom.Gender] = (acc[nom.Gender] || 0) + 1;
                    return acc;
                }, {});

                const labels = Object.keys(genderCount);
                const data = Object.values(genderCount);
                const colors = ['#e74c3c', '#3498db', '#f1c40f', '#9b59b6'];

                // Simple Bar Chart
                const max = Math.max(...data);
                const canvasHeight = ctx.canvas.height;
                const barWidth = 40;
                const spacing = (ctx.canvas.width - (barWidth * data.length)) / (data.length + 1);

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#ecf0f1';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';

                ctx.fillText('Nominees by Gender', ctx.canvas.width / 2, 20);

                data.forEach((count, index) => {
                    const barHeight = (count / max) * 150;
                    const x = spacing + index * (barWidth + spacing);
                    const y = canvasHeight - barHeight - 30;

                    ctx.fillStyle = colors[index % colors.length];
                    ctx.fillRect(x, y, barWidth, barHeight);

                    ctx.fillStyle = '#ecf0f1';
                    ctx.fillText(labels[index], x + barWidth / 2, canvasHeight - 10);
                    ctx.fillText(count, x + barWidth / 2, y - 10);
                });
            }

            closeNarrativeOverlay() {
                this.narrativeOverlay.style.opacity = '0';
                this.narrativeOverlay.style.pointerEvents = 'none';
            }

            submitStory() {
                const input = this.userInput.value.trim();
                if (input) {
                    const hasWoman = /woman/i.test(input);
                    this.addUserNarrative(input, hasWoman);
                    this.userInput.value = '';
                    this.createRippleEffect();
                }
            }

            addUserNarrative(text, hasWoman) {
                const node = document.createElement('div');
                node.classList.add('narrative-node');
                node.classList.add('user-narrative-node');
                node.style.backgroundColor = hasWoman ? '#e74c3c' : '#2ECC71';
                node.style.width = '80px';
                node.style.height = '80px';
                node.style.fontSize = '24px';
                node.style.top = `${Math.random() * (window.innerHeight - 100)}px`;
                node.style.left = `${Math.random() * (window.innerWidth - 100)}px`;

                const emoji = document.createElement('div');
                emoji.classList.add('emoji');
                emoji.textContent = hasWoman ? 'üë©' : 'üê∏';
                node.appendChild(emoji);

                node.addEventListener('click', () => this.openUserNarrative(text));

                this.container.appendChild(node);
            }

            openUserNarrative(text) {
                this.narrativeContent.innerHTML = `
                    <button id="close-narrative">‚úñ</button>
                    <h2>üí¨ Your Narrative</h2>
                    <p>${text}</p>
                `;
                this.narrativeOverlay.style.opacity = '1';
                this.narrativeOverlay.style.pointerEvents = 'all';

                // Re-attach close button listener
                document.getElementById('close-narrative').addEventListener('click', () => {
                    this.closeNarrativeOverlay();
                });
            }

            createRippleEffect() {
                const ripple = document.createElement('div');
                ripple.classList.add('ripple');
                ripple.style.left = `${Math.random() * 100}%`;
                ripple.style.top = `${Math.random() * 100}%`;
                ripple.style.animationDelay = `${Math.random() * 2}s`;
                this.container.appendChild(ripple);

                // Remove ripple after animation
                setTimeout(() => {
                    ripple.remove();
                }, 2000);
            }
        }

        // Initialize the Narrative Pond
        document.addEventListener('DOMContentLoaded', () => {
            new NarrativePond(camerimageData);
        });
    </script>
</body>
</html>
