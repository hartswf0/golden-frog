<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Frog Competition Interactive Pond</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        :root {
            --primary-color: #1B4F72;
            --secondary-color: #2ECC71;
            --text-color: #333;
            --background-color: #f4f4f4;
            --overlay-background: rgba(27, 79, 114, 0.9);
            --contrast-background: #000;
            --contrast-text: #FFF;
        }

        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            overflow: hidden;
        }

        .app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .pond-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .narrative-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-background);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .narrative-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .input-area {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            width: 90%;
            max-width: 600px;
            z-index: 100;
        }

        #user-input {
            flex-grow: 1;
            padding: 10px;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            resize: none;
            height: 100px;
            font-size: 16px;
            color: #333;
            background-color: #fff;
        }

        #submit-story {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 16px;
        }

        #submit-story:hover {
            background-color: #27AE60;
        }

        .accessibility-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .accessibility-controls button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .accessibility-controls button:hover {
            background-color: #2ECC71;
        }

        /* High Contrast Mode */
        body.high-contrast {
            --primary-color: #000;
            --secondary-color: #FFF;
            --text-color: #FFF;
            --background-color: #000;
            --overlay-background: rgba(255, 255, 255, 0.9);
        }

        body.high-contrast .narrative-content {
            background-color: black;
            color: white;
            border: 2px solid white;
        }

        body.high-contrast #user-input {
            background-color: #333;
            color: white;
            border: 2px solid #FFF;
        }

        body.high-contrast #submit-story {
            background-color: #FFF;
            color: #000;
        }

        body.high-contrast #submit-story:hover {
            background-color: #CCC;
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .input-area {
                flex-direction: column;
                width: 95%;
            }

            #user-input {
                height: 80px;
                font-size: 14px;
            }

            .accessibility-controls {
                top: 10px;
                right: 10px;
            }

            .accessibility-controls button {
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="pond-container" class="pond-container"></div>
        
        <div id="narrative-overlay" class="narrative-overlay" aria-modal="true" role="dialog">
            <div id="narrative-content" class="narrative-content"></div>
        </div>
        
        <div id="input-area" class="input-area">
            <textarea 
                id="user-input" 
                placeholder="Share your Golden Frog story..." 
                aria-label="Personal narrative input"
            ></textarea>
            <button 
                id="submit-story" 
                aria-label="Submit narrative"
            >
                Submit Story
            </button>
        </div>
        
        <div id="accessibility-controls" class="accessibility-controls">
            <button id="toggle-contrast" aria-label="Toggle high contrast mode">
                Toggle Contrast
            </button>
            <button id="increase-text-size" aria-label="Increase text size">
                A+
            </button>
            <button id="decrease-text-size" aria-label="Decrease text size">
                A-
            </button>
        </div>
    </div>

    <script>
        // Sample Social Listening Data
        const socialListeningData = {
            "social_listening_data": {
                "queries": ["camerimage", "women in cinematography", "female cinematography"],
                "results_summary": {
                    "camerimage": {
                        "results": 455,
                        "engagement": 12400,
                        "sentiment": {
                            "positive": "64.8%",
                            "negative": "5.2%"
                        },
                        "potential_reach": "2.1B"
                    },
                    "women_in_cinematography": {
                        "results": 166,
                        "engagement": 1900,
                        "sentiment": {
                            "positive": "42.2%",
                            "negative": "5.4%"
                        },
                        "potential_reach": "2.1B"
                    },
                    "female_cinematography": {
                        "results": 347,
                        "engagement": "N/A",
                        "sentiment": {
                            "positive": "N/A",
                            "negative": "N/A"
                        },
                        "potential_reach": "N/A"
                    }
                },
                "results_over_time": {
                    "camerimage": [ /* Timeline data points */ ],
                    "women_in_cinematography": [ /* Timeline data points */ ],
                    "female_cinematography": [ /* Timeline data points */ ]
                },
                "net_sentiment_over_time": {
                    "camerimage": [ /* Sentiment data points */ ],
                    "women_in_cinematography": [ /* Sentiment data points */ ],
                    "female_cinematography": [ /* Sentiment data points */ ]
                },
                "themes_wordcloud": {
                    "key_words": [
                        "camerimage", "festival", "poland", "award", "family", "instagram",
                        "comments", "gentle", "production", "world", "artistic", "feature"
                    ]
                },
                "geographic_data": {
                    "world_map": {
                        "locations": [
                            {
                                "region": "United States",
                                "mentions": 455,
                                "share": "31%"
                            },
                            {
                                "region": "Poland",
                                "mentions": 347,
                                "share": "24%"
                            },
                            {
                                "region": "United Kingdom",
                                "mentions": "N/A",
                                "share": "20%"
                            }
                        ]
                    }
                }
            }
        };

        class GoldenFrogPond {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.width = this.container.clientWidth;
                this.height = this.container.clientHeight;
                
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, this.width / this.height, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                
                this.renderer.setSize(this.width, this.height);
                this.container.appendChild(this.renderer.domElement);
                
                this.setupLighting();
                this.createPondEnvironment();
                this.createInitialLilyPads();
                this.setupInteractions();
                this.setupUserStorySubmission();
                this.setupAccessibilityControls();
                
                this.camera.position.set(0, 5, 10);
                this.camera.lookAt(0, 0, 0);
                
                this.animate();
                this.setupResizeHandler();
            }
            
            setupLighting() {
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(0, 1, 1).normalize();
                this.scene.add(directionalLight);
            }
            
            createPondEnvironment() {
                // Central Spinning Frog
                const frogGeometry = new THREE.SphereGeometry(1, 32, 32);
                const frogMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0xffd700, 
                    emissive: 0x555500,
                    transparent: true,
                    opacity: 0.8
                });
                this.frog = new THREE.Mesh(frogGeometry, frogMaterial);
                this.scene.add(this.frog);
                
                // Pond Surface
                const pondGeometry = new THREE.PlaneGeometry(20, 20);
                const pondMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x1B4F72, 
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.6
                });
                const pond = new THREE.Mesh(pondGeometry, pondMaterial);
                pond.rotation.x = -Math.PI / 2;
                pond.position.y = -1;
                this.scene.add(pond);
            }
            
            createInitialLilyPads() {
                this.lilyPads = [];
                const radius = 5;
                
                const categories = [
                    { id: 'diversity', emoji: '🌈', title: 'Diversity Insights' },
                    { id: 'geography', emoji: '🌍', title: 'Geographic Distribution' },
                    { id: 'history', emoji: '⏳', title: 'Historical Trends' },
                    { id: 'impact', emoji: '💡', title: 'Social Impact' }
                ];
                
                categories.forEach((category, index) => {
                    const angle = (index / categories.length) * Math.PI * 2;
                    const x = radius * Math.cos(angle);
                    const z = radius * Math.sin(angle);
                    
                    const padGeometry = new THREE.CircleGeometry(0.5, 32);
                    const padMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x2ECC71, 
                        side: THREE.DoubleSide 
                    });
                    const lilyPad = new THREE.Mesh(padGeometry, padMaterial);
                    lilyPad.position.set(x, 0, z);
                    
                    // Add category metadata from socialListeningData
                    const dataSummary = socialListeningData.social_listening_data.results_summary[category.id] || {};
                    
                    lilyPad.userData = { 
                        ...category,
                        data: dataSummary,
                        type: 'initial'
                    };
                    
                    this.scene.add(lilyPad);
                    this.lilyPads.push(lilyPad);
                });
            }
            
            setupInteractions() {
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                
                this.renderer.domElement.addEventListener('click', this.onMouseClick.bind(this), false);
                this.renderer.domElement.addEventListener('mousemove', this.onMouseMove.bind(this), false);
            }
            
            onMouseMove(event) {
                this.mouse.x = (event.clientX / this.width) * 2 - 1;
                this.mouse.y = -(event.clientY / this.height) * 2 + 1;
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.lilyPads);
                
                this.container.style.cursor = intersects.length > 0 ? 'pointer' : 'default';
                
                // Optional hover effect
                this.lilyPads.forEach(pad => {
                    const isHovered = intersects.some(intersect => intersect.object === pad);
                    if (isHovered) {
                        gsap.to(pad.scale, { 
                            x: 1.2, 
                            y: 1.2, 
                            z: 1.2, 
                            duration: 0.3 
                        });
                    } else {
                        gsap.to(pad.scale, { 
                            x: 1, 
                            y: 1, 
                            z: 1, 
                            duration: 0.3 
                        });
                    }
                });
            }
            
            onMouseClick(event) {
                this.mouse.x = (event.clientX / this.width) * 2 - 1;
                this.mouse.y = -(event.clientY / this.height) * 2 + 1;
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.lilyPads);
                
                if (intersects.length > 0) {
                    const selectedPad = intersects[0].object;
                    this.openNarrativeOverlay(selectedPad.userData);
                }
            }
            
            openNarrativeOverlay(data) {
                const overlay = document.getElementById('narrative-overlay');
                const content = document.getElementById('narrative-content');
                
                // Generate dynamic content based on category
                content.innerHTML = `
                    <button id="close-narrative" aria-label="Close narrative">✖</button>
                    <h2>${data.emoji} ${data.title}</h2>
                    ${this.generateCategoryContent(data)}
                `;
                
                // Show overlay
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'all';
                
                // Close button listener
                document.getElementById('close-narrative').addEventListener('click', () => {
                    overlay.style.opacity = '0';
                    overlay.style.pointerEvents = 'none';
                });
            }
            
            generateCategoryContent(data) {
                if (data.id === 'diversity') {
                    const sentiment = data.data.sentiment || {};
                    const engagement = data.data.engagement || 'N/A';
                    const potentialReach = data.data.potentialReach || 'N/A';
                    const results = data.data.results || 'N/A';
                    
                    return `
                        <div class="sentiment-analysis">
                            <h3>Sentiment Analysis</h3>
                            <p>Positive: ${sentiment.positive || 'N/A'}%</p>
                            <p>Negative: ${sentiment.negative || 'N/A'}%</p>
                            <p>Engagement: ${engagement.toLocaleString()}</p>
                            <p>Potential Reach: ${potentialReach}</p>
                        </div>
                    `;
                } else if (data.id === 'geography') {
                    const locations = socialListeningData.social_listening_data.geographic_data.world_map.locations || [];
                    return `
                        <div class="geographic-distribution">
                            <h3>Geographic Mentions</h3>
                            <ul>
                                ${locations.map(location => `
                                    <li>
                                        <strong>${location.region}</strong>: 
                                        ${location.mentions} mentions (${location.share} share)
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                } else if (data.id === 'history') {
                    // Placeholder for historical trends
                    return `
                        <div class="historical-trends">
                            <h3>Historical Trends</h3>
                            <p>Detailed historical insights are coming soon!</p>
                        </div>
                    `;
                } else if (data.id === 'impact') {
                    // Placeholder for social impact
                    return `
                        <div class="social-impact">
                            <h3>Social Impact</h3>
                            <p>Exploring the broader influence of the Golden Frog Competition on cinematography.</p>
                        </div>
                    `;
                } else {
                    return '<p>No specific details available for this category.</p>';
                }
            }
            
            setupUserStorySubmission() {
                const input = document.getElementById('user-input');
                const submitButton = document.getElementById('submit-story');
                
                submitButton.addEventListener('click', () => {
                    const text = input.value.trim();
                    if (text) {
                        this.addUserNarrative(text);
                        input.value = '';
                    }
                });
            }
            
            addUserNarrative(text) {
                const hasWoman = /woman/i.test(text);
                const emoji = hasWoman ? '👩' : '🐸';
                const color = hasWoman ? 0xe74c3c : 0x2ECC71;
                
                // Create Lily Pad
                const padGeometry = new THREE.CircleGeometry(0.5, 32);
                const padMaterial = new THREE.MeshStandardMaterial({ 
                    color: color, 
                    side: THREE.DoubleSide 
                });
                const lilyPad = new THREE.Mesh(padGeometry, padMaterial);
                
                // Random Position within the pond radius
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 5;
                lilyPad.position.set(Math.cos(angle) * distance, 0, Math.sin(angle) * distance);
                
                // Add emoji as a sprite
                const spriteMap = new THREE.TextureLoader().load(`https://twemoji.maxcdn.com/v/latest/svg/${this.emojiToUnicode(emoji)}.svg`);
                const spriteMaterial = new THREE.SpriteMaterial({ map: spriteMap, transparent: true });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(0.5, 0.5, 1);
                lilyPad.add(sprite);
                
                // Add user data
                lilyPad.userData = { 
                    emoji: emoji, 
                    text: text, 
                    type: 'user' 
                };
                
                // Add to scene and lilyPads array
                this.scene.add(lilyPad);
                this.lilyPads.push(lilyPad);
                
                // Animate the new lily pad (e.g., fade in)
                lilyPad.material.opacity = 0;
                gsap.to(lilyPad.material, { opacity: 0.6, duration: 1 });
                
                // Optionally, add a ripple effect
                this.createRippleEffect(lilyPad.position);
            }
            
            // Helper function to convert emoji to Unicode for loading sprite
            emojiToUnicode(emoji) {
                return emoji.codePointAt(0).toString(16).toUpperCase();
            }
            
            openUserNarrativeOverlay(text) {
                const overlay = document.getElementById('narrative-overlay');
                const content = document.getElementById('narrative-content');
                
                content.innerHTML = `
                    <button id="close-narrative" aria-label="Close narrative">✖</button>
                    <h2>Your Narrative 🐸</h2>
                    <p>${text}</p>
                `;
                
                // Show overlay
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'all';
                
                // Close button listener
                document.getElementById('close-narrative').addEventListener('click', () => {
                    overlay.style.opacity = '0';
                    overlay.style.pointerEvents = 'none';
                });
            }
            
            setupAccessibilityControls() {
                const toggleContrastBtn = document.getElementById('toggle-contrast');
                const increaseTextBtn = document.getElementById('increase-text-size');
                const decreaseTextBtn = document.getElementById('decrease-text-size');
                
                toggleContrastBtn.addEventListener('click', () => {
                    document.body.classList.toggle('high-contrast');
                });
                
                increaseTextBtn.addEventListener('click', () => {
                    document.body.style.fontSize = `${parseFloat(getComputedStyle(document.body).fontSize) + 2}px`;
                });
                
                decreaseTextBtn.addEventListener('click', () => {
                    document.body.style.fontSize = `${parseFloat(getComputedStyle(document.body).fontSize) - 2}px`;
                });
            }
            
            setupResizeHandler() {
                window.addEventListener('resize', () => {
                    this.width = this.container.clientWidth;
                    this.height = this.container.clientHeight;
                    this.camera.aspect = this.width / this.height;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(this.width, this.height);
                });
            }
            
            animate() {
                requestAnimationFrame(this.animate.bind(this));
                this.frog.rotation.y += 0.01; // Spin the frog
                this.renderer.render(this.scene, this.camera);
            }
            
            createRippleEffect(position) {
                // Create a small sphere that scales up and fades out
                const rippleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                const rippleMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xFFFFFF, 
                    transparent: true, 
                    opacity: 0.5 
                });
                const ripple = new THREE.Mesh(rippleGeometry, rippleMaterial);
                ripple.position.set(position.x, 0.1, position.z);
                this.scene.add(ripple);
                
                // Animate the ripple
                gsap.to(ripple.scale, { x: 2, y: 2, z: 2, duration: 2 });
                gsap.to(ripple.material, { opacity: 0, duration: 2, onComplete: () => {
                    this.scene.remove(ripple);
                }});
            }
        }

        // Initialize the Golden Frog Pond
        document.addEventListener('DOMContentLoaded', () => {
            new GoldenFrogPond('pond-container');
        });
    </script>
</body>
</html>
